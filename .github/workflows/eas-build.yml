name: EAS Build (Android, npm)

on:
  push:
    branches:
      - master
  workflow_dispatch: # ğŸ‘‰ ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥í•˜ê²Œ

jobs:
  build-android:
    runs-on: ubuntu-latest

    steps:
      # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2. Node.js ì„¤ì • (ë²„ì „ì€ ë„ˆ í”„ë¡œì íŠ¸ì— ë§ê²Œ)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"

      # 3. ì˜ì¡´ì„± ì„¤ì¹˜ (npm)
      - name: Install dependencies
        # package-lock.json ìˆìœ¼ë©´ npm ci, ì—†ìœ¼ë©´ npm install
        run: |
          npm install

      # 4. EAS CLI ì„¤ì¹˜ (ì „ì—­ ì„¤ì¹˜)
      - name: Install EAS CLI
        run: |
          npm install -g eas-cli

      # 5. Expo í† í° í™•ì¸
      - name: Check EXPO_TOKEN
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: |
          if [ -z "$EXPO_TOKEN" ]; then
            echo "âŒ EXPO_TOKENì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. GitHub Secretsì— ì¶”ê°€í•˜ì„¸ìš”."
            exit 1
          fi
          echo "âœ… EXPO_TOKEN ê°ì§€ë¨"

      # 6. EAS ë¹Œë“œ ì‹¤í–‰ (Android)
      - name: Run EAS Build (Android)
        env:
          EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        run: |
          eas build --platform android --non-interactive
          # íŠ¹ì • í”„ë¡œíŒŒì¼ ì“°ê³  ì‹¶ìœ¼ë©´:
          # eas build --platform android --profile production --non-interactive
